---
title: 'Stat. Inf. II: Assignment 1'
author: 'Naimul Chowdhury'
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Reading:
  a. Read the remaining Sections in Chapter 9: 9.3, 9.5 and 9.6. And, read the final section about errors and power on the R handout for inference about a proportion.
  

# Problem #1

**Prelude.**

We know that, for $x_1,x_2,\dots,x_n \sim N(\mu, \sigma^2)$, the following is true:
$$\bar{X} \sim N(\mu, \sigma/\sqrt{n}),$$
which leads to
$$ Z = \frac{\bar{X} - \mu}{\sigma/\sqrt{n}} \sim N(0,1)$$
Typically, we don't have access to population standard deviation $\sigma$, hence we substitute it by sample standard deviation $s = \sqrt{\frac{\sum_i (x_i - \bar{x})^2}{n-1}}$. Then, the test statistic becomes
$$ T= \frac{\bar{X} - \mu}{s/\sqrt{n}} \sim t_{n-1},$$
where $t$-distribution is

  * like $N(0,1)$, symmetric, bell-shaped and centered at $0$,
  * but has heavier tails (see \url{https://istats.shinyapps.io/tdist/} for demo).
  
By **mathematical definition**, random variable $T$ has a $t$-distribution with $df$ degrees of freedom if
$$T = \frac{Z}{\sqrt{X_{df}^2/df}} \sim t_{df},$$
where $Z \sim N(0,1)$, $X^2_{df} \sim \chi^2_{df}$ (for definition of $\chi^2_{df}$, please see the \url{https://en.wikipedia.org/wiki/Chi-squared_distribution} or the last set of slides from previous semester).

By **Cochran's theorem**, the following is true:
  $$ \textbf{z}'A\textbf{z} \sim \chi^2_{rank(A)},$$
  where
  
  * $\textbf{z}=(z_1, z_2,\dots,z_n)'$, with $z_1,z_2,\dots,z_n$ being independent standard normal random variables (in short, $z_1, z_2,\dots,z_n \sim_{ind} N(0,1)$).
  * $A$ is a  symmetric, idempotent matrix,

 \newpage 
 
**Actual problem.**
Piece-by-piece, we will proceed to show that, for $x_1,\dots,x_n \sim N(\mu,\sigma^2)$, the test statistic $T=\frac{\bar{X} - \mu}{s/\sqrt{n}}$ follows the **mathematical definition** of $t_{n-1}$ distribution, as in

$$ $$

**Main statement:**
$$T= \frac{\bar{X} - \mu}{s/\sqrt{n}} = \frac{Z}{\sqrt{X_{n-1}^2/(n-1)}} \sim t_{n-1},$$
where $Z \sim N(0,1)$, $X^2_{n-1} \sim \chi^2_{n-1}$.

  1. Show that
  
  $$\bar{X} - \mu = \frac{\sigma}{\sqrt{n}} Z, \ \ Z \sim N(0,1)$$
  
  Proof: The $\chi^2$ distribution is the square of independent standard normal distribution,
  
  $$ \chi^2_{df} = \sum_i^{df} Z^2_i.$$
  
  Also note that the sample mean $\bar{X}$ has follows a normal distribution with mean $\mu$ and standard deviation $\sigma$,
  
  $$\bar{X} \sim N(\mu, \frac{\sigma^2}{n}).$$
  
  Finally, note that $Z$ is given by
  
  $$Z = \frac{\bar{X} - \mu}{\frac{\sigma}{\sqrt{n}}}.$$
  
  Thus by simple algebra we arrive at the desired conclusion.
  
  2. Show that
  $$ \sum_i (x_i - \bar{x})^2 = \sigma^2 \sum_i (z_i - \bar{z})^2,$$ where $z_1,z_2,\dots,z_n \sim_{ind} N(0,1)$.
  
  3. Applying the basic "row-by-column" matrix multiplication, proceed to calculate $\textbf{z}'A_{n\times n} = (z_1,z_2,\dots,z_n) \times A_{n\times n}$, where 
  $$A = \textbf{I}_{n\times n} - \frac{1}{n} \textbf{1}_{n\times n}$$
  $$\textbf{I}_{n\times n} = diag(\underbrace{1,1,\dots,1}_{n}) = \begin{pmatrix} 1 & 0 & 0 & \dots & 0 & 0 \\
                                          0 & 1 & 0 & \dots & 0 & 0 \\
                                          \dots \\
                                          0 & 0 & 0 & \dots & 0 & 1\\
                                          \end{pmatrix}, \ \ \textbf{1}_{n\times n} = \begin{pmatrix} 1 & 1 & 1 & \dots & 1 & 1 \\
                                          1 & 1 & 1 & \dots & 1 & 1 \\
                                          \dots \\
                                          1 & 1 & 1 & \dots & 1 & 1\\
                                          \end{pmatrix}$$
                                          
  4. Using your result from part $3$, show that $(\textbf{z}'A_{n\times n})(\textbf{z}'A_{n\times n})' = \sum_i (z_i - \bar{z})^2$.
  
  5. For matrix $A_{n \times n}$ as defined in part $3$, show that it is **idempotent**, as in
  $$A_{n\times n} \times A_{n \times n} = A_{n \times n},$$
  hence, combined with part $4$, leading to the fact that
  $$\sum_i (z_i - \bar{z})^2 = (\textbf{z}'A_{n\times n})(\textbf{z}'A_{n\times n})' = \textbf{z}'A_{n\times n}A'_{n\times n}\textbf{z} =\textbf{z}'A_{n\times n}\textbf{z}$$
  
  6. Matrix $A_{n\times n}$ as  defined in part $3$, has rank of $n-1$. Why not $n$?
  
  7. Combine the parts $2, 5$ and $6$ with **Cochran's theorem** (see page $1$) to show that
  $$s/\sqrt{n} = \sqrt{\sum_i (x_i - \bar{x})^2/(n-1)} \times \frac{1}{\sqrt{n}} = \sqrt{\sigma^2 X^2_{n-1}/(n-1)} \times \frac{1}{\sqrt{n}}, \ \ X^2_{n-1} \sim \chi^2_{n-1}$$
  8. Combine parts $2$ and $7$ to prove the **main statement**.
  
  $$ $$
  
  **Note**: Some extra details could be found here (see p. 1-2 of the main post): \url{https://stats.stackexchange.com/questions/306937/quadratic-form-and-chi-squared-distribution}.

# Problem 2:

 1. Write a _prop.sample.size()_ function that will output the sample size needed for a one-sample proportion test to achieve

- a desired margin of error (argument #1)

- for a given confidence level (argument #2)

in the "worst-case scenario" (as was explained in class). What was meant by the "worst-case scenario"?

### Solution 1.

We recall that 

$$m = z_{1 - \alpha/2} \cdot \sqrt{\frac{\hat{p}(1-\hat{p})}{n}}.$$


We wish to compute the desired sample size given margin of error $m$ and confidence level $1- \frac{\alpha}{2}$.

In particular, we wish to account for the "worst-case scenario", where the standard error is maximized by our choice of $\hat{p}$.


```{r}
prop.sample.size <- function(m, conf) {
  n <- (qnorm(conf)^2 * 0.5^2)/(m^2)
  response <- c("The sample size for a one-sample proportion test with a desired margin of error", m, " and given confidence level", conf, " is ", n)
  return(response)
}
```


For example, suppose $m = 0.4$, and the given confidence level is 0.995. Then, 
```{r}
prop.sample.size(0.4, .995)
```


2. use your _prop.sample.size()_ from part 1 to do exercise 8.50 from the Agresti book.

How many businesses fail? A study is planned to estimate the proportion of businesses started in the year 2006 that failed within five years of their start-up. How large a sample size is needed to guarantee estimating this proportion correct to within

a. 0.10 with probability 0.95?

```{r}
prop.sample.size(0.10, 0.95)
```

b. 0.05 with probability 0.95?

```{r}
prop.sample.size(0.05, 0.95)
```

c. 0.05 with probability 0.99?

```{r}
prop.sample.size(0.05, 0.99)
```

d. Compare sample sizes for parts a and b, and b and c, and summarize the effects of decreasing the margin of error and increasing the confidence level.

3. Write a _mean.sample.size()_ function that will output the sample size needed for a one-sample mean test to achieve

- a desired margin of error (argument #1)

- for a given confidence level (argument #2)

- for a given standard deviation (argument #3)

Proceed to use that function in order to do exercise 8.53 from the Agresti book.

### Solution 3

Recall that

$$t_{(n-1), \ 1-\alpha/2} \cdot \frac{s}{\sqrt{n}} = m,$$

implying,

$$n = \frac{ \sigma^2 z^2 } {m^2}.$$

This is working under the assumption that we have a population size of at least $n = 30$, since this would make our distrubution approach the normal distribution.


Thus we can construct our function.

```{r}
mean.sample.size <- function(m, conf, s) {
  n <- ((s * qnorm(conf))/m)^2
  response <- c("The sample size for a one-sample mean test with a desired margin of error,", m, " given confidence level", conf, "and standard deviation", s,  " is ", n)
  return(response)
}
```

(8.53) _Income of the Native Americans_ How large a sample size do we need to estimate the mean annual income of Native Americans in onondaga County, New York, correct to within \$1000 with probability 0.99? No information is available to us about the standar deviation of their annual income. We guess that nearly all of the incomes fall between \$0 and \$120,000 and that this distribution is approximately bell shaped.

### Solution

We are given that $m = 1000$, and the confidence level is 0.99. Although we are not given the standard deviation $\sigma$, we recall that we may approximate $\sigma$ by


$$ \sigma \approx \frac{range}{6},$$

since 99% of the data lies within 3 standar deviations from the average, or 1/6 of the range.

Thus

$$\sigma \approx \frac{120,000}{6} = 20,000.$$


Using the function written above,

```{r}
mean.sample.size(1000, 0.99, 20000)
```

We find that 2165 participants are needed to reach the desired criteria.




