---
title: "Stats. Inference Assignment 4"
author: "Naeem Chowdhury"
date: "5/25/2020"
output: pdf_document
---


##1. Setup
### options
Set up global options
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_chunk$set(tidy=TRUE)
knitr::opts_chunk$set(tidy.opts=list(width.cutoff=70))
knitr::opts_chunk$set(fig.height=4, fig.width=6)
```

### libraries
Load in needed libraries 
```{r, include=FALSE}
library(tidyverse)
library(RColorBrewer)
library(haven)
```

## 2. File management
### Create variables for directories
```{r file_management, include=FALSE}
project.dir <- getwd() #naeem
output.dir <- "/Output"
data.dir <- "C:/Users/Naeem Cho/Desktop/School Work/Statistical Inference/Datasets"
setwd(project.dir)
getwd()
```

## 3. Importing Data
```{r}
cpu.data <- read_csv(file.path(data.dir, "Intel_CPUs.csv"))
```


**The goal of this homework is to have you 1) Familiarized with the $\chi^2$ test of independence for contingency tables; 2) measuring practical strength of dependence between categorical variables; 3) familiarized with permutation test for contingency tables; 4) practice your R coding.**

# Problem #1

## 1. For all three examples on slide #24, proceed to

```{r}
case.A <- matrix(c(51, 49, 49, 51), ncol = 2, byrow = TRUE)
colnames(case.A) <- c("Yes", "No")
rownames(case.A) <- c("Female", "Male")
case.A <- as.table(case.A)

case.B <- matrix(c(102, 98, 98, 102), ncol = 2, byrow = TRUE)
colnames(case.B) <- c("Yes", "No")
rownames(case.B) <- c("Female", "Male")
case.B <- as.table(case.B)

case.C <- matrix(c(5100, 4900, 4900, 5100), ncol = 2, byrow = TRUE)
colnames(case.C) <- c("Yes", "No")
rownames(case.C) <- c("Female", "Male")
case.C <- as.table(case.C)
```


### a. Use the _my.chisq.test()_ function you've defined in the previous HW in order to confirm the $X^2$ and $p$-values. __Hint:__ Make sure to convert the %'s into counts first.

Establishing _my.chisq.test()_:
```{r}
my.chisq.test <- function(ctable) {
  rows <- nrow(ctable)
  cols <- ncol(ctable)
  
  rowsums <- rowSums(ctable)
  colsums <-colSums(ctable)
  
  total <- sum(ctable)
  df <- (rows-1)*(cols-1)
  
  expected <- matrix(0, nrow = rows, ncol = cols)
  
  for(i in 1:rows){
    
    for(j in 1:cols){
      
      expected[i,j] <- (rowsums[i]*colsums[j])/ total
      
    }
  }
  chi_sq <- ((ctable - expected)^2)/expected
  chi_sq <- sum(chi_sq)
  
  p <- pchisq(chi_sq, df, lower.tail = FALSE)
  
  
  print(c("X-Squared: ",  chi_sq))
  print(c("Degrees of Freedom: ", df))
  print(c("p-value: ", p))
  # print(c("Matrix of expected counts: ", expected))
}
```

```{r}
#Case A
my.chisq.test(case.A)
```

```{r}
#Case B
my.chisq.test(case.B)
```
```{r}
#Case C
my.chisq.test(case.C)
```

The results of all 3 tests line-up with the results of the tests presented in the slides!

### b. Calculate the difference in proportion between males and females that attend religious services weekly. Calculate the risk ratio between males and females that attend religious services weekly.

### c. Based on your answers to parts (a) - (b), as $n$ increases, what do you notice with respoect to statistical significance? Practical significance?

## 2. Do exercises **11.32** and **11.33** from the **Agresti** book.

# Problem #2

## 1. Code up your own _my.permutation.test()_ function to conduct permutation tests on contingency tables. As inputs, it should take a dataframe with two categorical variables as columns (first one - explanatory, second one - response), and the number of randomly generated permutationts to be executed. As output, it should provide:

    - contingency table for the data frame,
    
    - permutation $p$-value,
    
    - plot the histogram of permutation distribution for $X^2$ statistic.
    
  To obtain $X^2$ values for each permutation, you are allowed to use $R$'s _chisq.test()_ function.
  
## 2. Proceed to apply the _my.permutation.test()_ function (and subsequently interpret the results) to:

### a. GPU_data, with 10,000 permutations. What's the conclusion? Compare the resulting histogram with the one in the slides (they should be roughly similar).

### b. Intel_CPU data, with just 1,000 permutations. What's the conclusion? Compare the shape of the resulting histogram with the density of $\chi^2$ distribution with appropriate degrees of freedom. What does it tell us about whether $\chi^2$-test results from HW3 were appropriate for Intel_CPU data?


# Problem #3

## 1. Complete the **lab** by wrapping everything we did into a nice, concise, R markdown report (just the code, with necessary comments, contingency table, test results, and interpretations).

## 2. Moreover, finish the **lab** by applying your _my.permutation.test()_ to inferring independence of court surface and match outcomes for Nadal vs. Federer, Serena vs Venus match-ups. Formulate the hypotheses, explain why $\chi^2$-test might be inappropriate, and deliver the conclusion. Compare the conclusion with the one we got from $\chi^2$-test during the lab.